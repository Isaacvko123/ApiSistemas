<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>credenciales_web - Operación Técnica</title>
    <style>
      :root { --bg:#f4f6f8; --ink:#0f172a; --muted:#475569; --card:#ffffff; --accent:#0b3a5b; --line:#e2e8f0; --shadow: 0 14px 30px rgba(2,6,23,0.08); }
      * { box-sizing: border-box; }
      body { margin:0; font-family:"Manrope","Inter","Segoe UI",sans-serif; background: radial-gradient(900px 500px at 15% -10%, rgba(14,165,233,0.10), transparent 60%), radial-gradient(900px 500px at 85% -5%, rgba(15,118,110,0.08), transparent 60%), var(--bg); color: var(--ink); }
      header { padding: 32px 40px 24px; border-bottom: 1px solid var(--line); background:#fff; box-shadow: var(--shadow); position: sticky; top:0; z-index:10; }
      h1 { margin:0 0 6px; font-size:30px; letter-spacing:-0.6px; font-weight:800; }
      h2 { margin:0 0 10px; font-size:20px; font-weight:700; }
      h3 { margin:0 0 8px; font-size:18px; font-weight:700; }
      p { margin:0; color: var(--muted); }
      main { padding: 28px 40px 48px; display:grid; gap:16px; }
      .card { background: var(--card); border:1px solid var(--line); border-radius:16px; padding:18px; box-shadow: var(--shadow); }
      .nav { display:flex; gap:12px; margin-top:10px; flex-wrap:wrap; }
      .nav a { color: var(--accent); text-decoration:none; font-weight:700; padding:8px 14px; border-radius:999px; border:1px solid var(--line); background:#f8fafc; }
      .nav a:hover { background:#e2e8f0; }
      .grid { display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
      .box { border:1px solid var(--line); background:#fff; padding:12px; border-radius:12px; }
      ul { margin:8px 0 0; padding-left:18px; color: var(--muted); }
      li { margin:4px 0; }
      code { background:#f1f5f9; padding:2px 6px; border-radius:6px; }
      pre { background:#0f172a; color:#e2e8f0; padding:12px; border-radius:12px; overflow:auto; }
      table { width:100%; border-collapse: collapse; }
      th, td { text-align:left; padding:8px; border-bottom:1px solid var(--line); }
      th { color:#1e293b; font-weight:800; }
      .tag { display:inline-block; font-size:12px; padding:3px 10px; border-radius:999px; background:#e2e8f0; color:#1e293b; border:1px solid #cbd5e1; font-weight:700; }
      .role { font-weight:800; }
      @media (max-width: 720px) { header { padding:22px 20px; } main { padding:20px; } h1 { font-size:24px; } }
</style>
  </head>
  <body>
    <header>
      <h1>credenciales_web</h1>
      <p>Credenciales web cifradas (AES‑GCM).</p>
      <div class="nav">
        <a href="/docs/operacion">Índice</a>
        <a href="/docs/portal">Inicio</a>
        <a href="/docs">Swagger</a>
      </div>
    </header>
    <main>
      <section class="card">
        <h2>Descripción</h2>
        <p>Almacena usuario/contraseña cifrada. Lectura del secreto auditada.</p>
      </section>
      <section class="card">
        <h2>Relación visual rápida</h2>
        <svg viewBox="0 0 900 220" role="img" aria-label="Relaciones credenciales web"><rect x="30" y="60" width="200" height="90" rx="14" fill="#0b3a5b"/><text x="40" y="110" fill="#fff" font-size="14">CREDENCIAL_WEB</text><rect x="270" y="20" width="150" height="70" rx="12" fill="#0ea5e9"/><text x="305" y="60" fill="#fff" font-size="14">EMPLEADO</text><rect x="270" y="110" width="150" height="70" rx="12" fill="#0f766e"/><text x="315" y="150" fill="#fff" font-size="14">AREA</text><rect x="470" y="20" width="150" height="70" rx="12" fill="#0ea5e9"/><text x="510" y="60" fill="#fff" font-size="14">PUESTO</text><rect x="470" y="110" width="150" height="70" rx="12" fill="#0f766e"/><text x="500" y="150" fill="#fff" font-size="14">USUARIO</text><path d="M230 105 L270 55" stroke="#0f172a" stroke-width="2"/><path d="M230 105 L270 145" stroke="#0f172a" stroke-width="2"/><path d="M420 55 L470 55" stroke="#0f172a" stroke-width="2"/><path d="M420 145 L470 145" stroke="#0f172a" stroke-width="2"/></svg>
      </section>
      <section class="card">
        <h2>Campos clave</h2>
        <div class="grid"><div class="box"><div class="tag">Obligatorios</div><ul><li><code>nombre</code></li><li><code>url</code></li><li><code>usuario</code></li><li><code>password</code> (cifrado)</li></ul></div><div class="box"><div class="tag">Opcionales</div><ul><li><code>empleadoId</code></li><li><code>areaId</code></li><li><code>puestoId</code></li><li><code>notas</code></li><li><code>activo</code></li></ul></div></div>
      </section>
      <section class="card">
        <h2>Rutas y permisos</h2>
        <table><thead><tr><th>Ruta</th><th>Rol</th><th>Notas</th></tr></thead><tbody><tr><td><code>GET /credenciales</code></td><td class="role">Autenticado</td><td>Lista sin password.</td></tr><tr><td><code>GET /credenciales/:id</code></td><td class="role">Autenticado</td><td>Devuelve sin password.</td></tr><tr><td><code>GET /credenciales/:id/secret</code></td><td class="role">ADMIN / GERENTE</td><td>Devuelve password descifrado.</td></tr><tr><td><code>POST /credenciales</code></td><td class="role">ADMIN / GERENTE</td><td>Crea credencial.</td></tr><tr><td><code>PATCH /credenciales/:id</code></td><td class="role">ADMIN / GERENTE</td><td>Actualiza.</td></tr><tr><td><code>DELETE /credenciales/:id</code></td><td class="role">ADMIN / GERENTE</td><td>Soft delete (activo=false).</td></tr></tbody></table>
      </section>
      <section class="card">
        <h2>Controller (métodos)</h2>
        <div class="grid"><div class="box"><div class="tag">obtenerSecreto</div><ul><li>Audita CREDENCIAL_READ_SECRET.</li><li>Devuelve password en claro.</li></ul></div><div class="box"><div class="tag">crear</div><ul><li>Cifra password con AES-GCM.</li><li>Audit CREDENCIAL_CREATE.</li></ul></div><div class="box"><div class="tag">actualizar</div><ul><li>Si cambia password → re-cifra.</li><li>Audit CREDENCIAL_UPDATE.</li></ul></div><div class="box"><div class="tag">eliminar</div><ul><li>activo=false.</li><li>Audit CREDENCIAL_DELETE.</li></ul></div></div>
      </section>
      <section class="card">
        <h2>Modelo / Validaciones</h2>
        <ul><li><code>credencialWebCreateSchema</code>: nombre/url/usuario/password.</li><li><code>credencialWebUpdateSchema</code>: opcional + nullable para relaciones.</li><li><code>toCredencialWebPublic</code>: oculta passwordEnc/iv/tag.</li></ul>
      </section>
      <section class="card">
        <h2>Ejemplos (requests / responses)</h2>
        <div class="grid"><div class="box"><div class="tag">POST /credenciales</div><pre>{
  "nombre": "Microsoft 365",
  "url": "https://login.microsoftonline.com",
  "usuario": "admin@empresa.com",
  "password": "Secreta123"
}</pre></div><div class="box"><div class="tag">200 OK</div><pre>{
  "id": 9,
  "nombre": "Microsoft 365",
  "usuario": "admin@empresa.com",
  "activo": true
}</pre></div></div>
      </section>
      <section class="card">
        <h2>Errores comunes</h2>
        <table><thead><tr><th>HTTP</th><th>Causa</th><th>Solución</th></tr></thead><tbody><tr><td>400</td><td>Payload inválido</td><td>Revisar campos.</td></tr><tr><td>404</td><td>Credencial no encontrada</td><td>Validar id.</td></tr><tr><td>403</td><td>Sin permisos</td><td>Solo ADMIN/GERENTE.</td></tr></tbody></table>
      </section>
      <section class="card">
        <h2>Checklist operativo</h2>
        <ul><li>Validar rol.</li><li>Auditar lectura de secreto.</li><li>Rotar claves si aplica.</li></ul>
      </section>
    </main>
  </body>
</html>
